# 作業合意（Working Agreement）

このリポジトリでは、タスクの性質に応じて「軽量ループ」と「フル6ステップ」を使い分けるハイブリッド運用を採用します。

## 1) 既定: 軽量ループ（短サイクル）
- サイクル: 計画 → 実装 → テスト → レビュー
- 原則: 小さく出す（小パッチ/小PR）、1–2日のスコープを目安
- DoD（Definition of Done）
  - ユニットテスト緑（`pnpm run test:unit`）
  - Lint/Format パス（`pnpm run lint`/`pnpm run format`）
  - README/ヘルプ等の最小ドキュメント更新

## 2) 跨る変更/外部統合/不確実が高い場合: フル6ステップ
- サイクル: 調査 → 分析 → 計画 → 実行 → テスト → 評価
- 時間箱: 調査/分析 各30–60分を基本（超過はチケット分割）
- 記録: PR テンプレの「調査/分析/計画」に要点（3–5行）を残す。必要に応じて `docs/adr/` に簡易ADR。
- DoD 追記
  - 統合/ネットワークテストが必要な場合は `pnpm run test:net` を通す
  - 運用影響がある場合は `docs/` 更新（ガイド/運用/変更点）

## 3) テスト戦略
- `test:unit`: 依存をモックした高速・決定的テスト（PR/Pushで常時実行）
- `test:net`: ネットワーク/統合/E2E（スケジュール or 手動実行、PRでは任意）
- カバレッジ: 単体での基準を CI で監視（70%目安、段階的に引上げ）

## 4) 役割と責務
- 実装者: 小さなPRで提出/早めのレビュー依頼、PRテンプレのチェックリストを満たす
- レビュアー: 方針/安全性/ユーザ影響に注目し、DoD満足を確認

## 5) 変更の安全化
- フラグ/設定での段階的有効化（例: `--experimental-...`）
- 失敗時のロールバック手順を README/ドキュメントへ明記

---
関連: `docs/RISK_ENGINE.md`, `docs/OPERATIONS.md`, `docs/SWEEPING.md`

